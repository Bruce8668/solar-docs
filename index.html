<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Á∞ΩÁ¥ÑÊñá‰ª∂ËøΩËπ§</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
<style>
:root{--bg:#f4f4ef;--white:#fff;--text:#1a1a1a;--text2:#555;--text3:#999;--accent:#e67e22;--green:#27ae60;--red:#e55039;--border:#e5e5df;--shadow:0 1px 4px rgba(0,0,0,.06)}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{font-family:'Noto Sans TC',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;padding-bottom:env(safe-area-inset-bottom,0)}

/* === HEADER === */
.hdr{background:var(--white);padding:18px 20px 14px;border-bottom:1px solid var(--border);position:sticky;top:0;z-index:50}
.hdr h1{font-size:20px;font-weight:900}.hdr h1 span{color:var(--accent)}
.hdr-sub{font-size:11px;color:var(--text3);margin-top:2px}

/* === PAGE: PROJECT LIST === */
.page{display:none}.page.show{display:block}

.proj-list{padding:16px 20px 100px}
.proj-list h2{font-size:14px;font-weight:700;color:var(--text2);margin-bottom:12px;display:flex;align-items:center;gap:6px}
.proj-list h2 .cnt{background:var(--accent);color:#fff;font-size:11px;padding:1px 8px;border-radius:99px}

.proj-card{background:var(--white);border-radius:14px;border:1.5px solid var(--border);padding:14px 16px;margin-bottom:8px;cursor:pointer;transition:all .15s;box-shadow:var(--shadow)}
.proj-card:active{transform:scale(.985)}
.proj-top{display:flex;align-items:center;gap:10px;margin-bottom:8px}
.proj-icon{font-size:22px}
.proj-info{flex:1;min-width:0}
.proj-name{font-size:15px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.proj-type{font-size:11px;color:var(--text3);margin-top:1px}
.proj-date{font-size:10px;color:var(--text3)}
.proj-prog{display:flex;align-items:center;gap:10px}
.proj-track{flex:1;height:5px;background:#eee;border-radius:99px;overflow:hidden}
.proj-fill{height:100%;border-radius:99px;transition:width .3s}
.proj-pct{font-size:12px;font-weight:700;min-width:36px;text-align:right}
.pct-low{color:var(--red)}
.pct-mid{color:var(--accent)}
.pct-done{color:var(--green)}

.empty-msg{text-align:center;padding:60px 20px;color:var(--text3)}
.empty-msg .em-icon{font-size:48px;margin-bottom:10px}
.empty-msg p{font-size:14px;line-height:1.6}

/* Add button */
.fab{position:fixed;bottom:calc(24px + env(safe-area-inset-bottom,0px));right:20px;width:56px;height:56px;border-radius:50%;background:var(--accent);color:#fff;border:none;font-size:28px;font-weight:400;cursor:pointer;box-shadow:0 4px 16px rgba(230,126,34,.4);transition:all .15s;z-index:60;display:flex;align-items:center;justify-content:center}
.fab:active{transform:scale(.9)}

/* === PAGE: NEW PROJECT === */
.form-page{padding:16px 20px 40px}
.form-page h2{font-size:16px;font-weight:700;margin-bottom:16px}
.field{margin-bottom:14px}
.field label{font-size:12px;font-weight:600;color:var(--text2);display:block;margin-bottom:5px}
.field input{width:100%;padding:11px 14px;border-radius:10px;border:1.5px solid var(--border);background:var(--white);font-family:inherit;font-size:14px;color:var(--text);outline:none}
.field input:focus{border-color:var(--accent)}
.type-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.type-opt{padding:12px;border-radius:12px;border:1.5px solid var(--border);background:var(--white);cursor:pointer;text-align:center;transition:all .2s;font-family:inherit}
.type-opt:active{transform:scale(.97)}
.type-opt.sel{border-color:var(--accent);background:#fef6ed}
.type-opt .to-icon{font-size:22px}
.type-opt .to-label{font-size:12px;font-weight:600;margin-top:4px;color:var(--text)}
.form-btns{display:flex;gap:8px;margin-top:20px}
.fbtn{flex:1;padding:13px;border-radius:12px;border:none;font-family:inherit;font-size:14px;font-weight:700;cursor:pointer}
.fbtn:active{transform:scale(.97)}
.fbtn-cancel{background:#eee;color:var(--text2)}
.fbtn-ok{background:var(--accent);color:#fff}

/* === PAGE: PROJECT DETAIL === */
.det-hdr{background:var(--white);padding:14px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:12px;position:sticky;top:56px;z-index:40}
.back-btn{background:none;border:none;font-size:22px;cursor:pointer;padding:4px;color:var(--text)}
.det-title{flex:1;min-width:0}
.det-name{font-size:16px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.det-type{font-size:11px;color:var(--text3)}
.det-del{background:none;border:none;font-size:18px;cursor:pointer;padding:6px;color:var(--red)}

.det-bar{display:flex;align-items:center;gap:10px;padding:12px 20px 4px}
.det-filters{display:flex;gap:6px}
.dfil{padding:4px 10px;border-radius:6px;font-size:11px;font-weight:600;border:none;cursor:pointer;font-family:inherit;background:#eee;color:var(--text2);transition:all .2s}
.dfil.on-all{background:var(--accent);color:#fff}
.dfil.on-pending{background:var(--red);color:#fff}
.dfil.on-done{background:var(--green);color:#fff}
.det-spacer{flex:1}
.det-prog{font-size:13px;font-weight:700;color:var(--accent)}
.det-track{margin:0 20px 6px;height:4px;background:#e0e0da;border-radius:99px;overflow:hidden}
.det-fill{height:100%;background:var(--accent);border-radius:99px;transition:width .35s}

.det-list{padding:4px 20px 120px}
.item{display:flex;align-items:flex-start;gap:12px;padding:12px 14px;margin-bottom:5px;background:var(--white);border-radius:12px;border:1.5px solid var(--border);cursor:pointer;transition:all .15s}
.item:active{transform:scale(.985)}
.item.done{background:#f0faf4;border-color:#c8e6c9}
.item.done .itxt{color:var(--text3);text-decoration:line-through}
.item.hide{display:none}
.ck{flex-shrink:0;width:24px;height:24px;border-radius:50%;border:2px solid #ccc;display:flex;align-items:center;justify-content:center;transition:all .2s;margin-top:1px}
.item.done .ck{background:var(--green);border-color:var(--green)}
.ck svg{opacity:0;transform:scale(0);transition:all .2s cubic-bezier(.34,1.56,.64,1)}
.item.done .ck svg{opacity:1;transform:scale(1)}
.icontent{flex:1;min-width:0}
.inum{font-size:11px;font-weight:700;color:var(--accent)}
.itxt{font-size:14px;line-height:1.5;transition:all .2s}
.inote{font-size:11px;color:var(--text2);margin-top:4px;padding:4px 8px;background:#fef9f0;border-radius:6px;border-left:2px solid var(--accent);line-height:1.4}
.itag{display:inline-block;font-size:10px;font-weight:700;padding:2px 7px;border-radius:4px;margin-right:3px;margin-top:4px}
.t-land{background:#eaf2fb;color:#2980b9}
.t-bld{background:#f3eafa;color:#8e44ad}

.det-bottom{position:fixed;bottom:0;left:0;right:0;padding:10px 20px calc(10px + env(safe-area-inset-bottom,0px));background:rgba(244,244,239,.92);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border-top:1px solid var(--border);z-index:60}
.det-bottom .btn{width:100%;padding:13px;border-radius:12px;border:none;font-family:inherit;font-size:14px;font-weight:700;cursor:pointer;background:var(--accent);color:#fff;display:flex;align-items:center;justify-content:center;gap:6px}
.det-bottom .btn:active{transform:scale(.97)}

/* Modal */
.modal-bg{display:none;position:fixed;inset:0;z-index:200;background:rgba(0,0,0,.35);align-items:flex-end;justify-content:center}
.modal-bg.show{display:flex}
.modal{background:var(--white);border-radius:20px 20px 0 0;width:100%;max-width:500px;padding:20px 20px calc(20px + env(safe-area-inset-bottom,0px));animation:mUp .25s ease}
@keyframes mUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
.modal h3{font-size:16px;font-weight:700;margin-bottom:12px}
.modal textarea{width:100%;height:200px;border:1.5px solid var(--border);border-radius:10px;padding:12px;font-family:inherit;font-size:13px;color:var(--text);resize:none;outline:none;line-height:1.6;background:var(--bg)}
.modal-btns{display:flex;gap:8px;margin-top:12px}
.modal-btns .mbtn{flex:1;padding:12px;border-radius:12px;border:none;font-family:inherit;font-size:13px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:4px}
.mbtn:active{transform:scale(.97)}
.mbtn-close{background:#eee;color:var(--text2)}
.mbtn-copy{background:var(--accent);color:#fff}
.mbtn-line{background:#06c755;color:#fff}

.toast{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(.85);background:var(--green);color:#fff;padding:14px 28px;border-radius:14px;font-weight:700;font-size:14px;opacity:0;pointer-events:none;transition:all .3s cubic-bezier(.34,1.56,.64,1);z-index:999;box-shadow:0 6px 24px rgba(39,174,96,.35)}
.toast.show{opacity:1;transform:translate(-50%,-50%) scale(1)}
</style>
</head>
<body>

<div class="hdr">
  <h1>‚òÄÔ∏è Á∞ΩÁ¥ÑÊñá‰ª∂<span>ËøΩËπ§</span></h1>
  <div class="hdr-sub">Êñ∞Â¢ûÊ°à‰ª∂ ‚Üí ÂãæÈÅ∏Êî∂Âà∞Êñá‰ª∂ ‚Üí ÂÇ≥ LINE ÂÇ¨‰ª∂</div>
</div>

<!-- PAGE 1: Project List -->
<div class="page show" id="pageList">
  <div class="proj-list" id="projList"></div>
  <button class="fab" onclick="showNew()">Ôºã</button>
</div>

<!-- PAGE 2: New Project -->
<div class="page" id="pageNew">
  <div class="form-page">
    <h2>‚ûï Êñ∞Â¢ûÊ°à‰ª∂</h2>
    <div class="field">
      <label>ÂÆ¢Êà∂ÂêçÁ®± / Ê°àÂ†¥ÂêçÁ®±</label>
      <input type="text" id="fName" placeholder="‰æãÔºöÁéãÂÖàÁîü / Âè∞ÂçóÂñÑÂåñÊ°à">
    </div>
    <div class="field">
      <label>ÈÅ∏ÊìáÂ∞àÊ°àÈ°ûÂûã</label>
      <div class="type-grid" id="typeGrid"></div>
    </div>
    <div class="form-btns">
      <button class="fbtn fbtn-cancel" onclick="goHome()">ÂèñÊ∂à</button>
      <button class="fbtn fbtn-ok" onclick="createProj()">Âª∫Á´ãÊ°à‰ª∂</button>
    </div>
  </div>
</div>

<!-- PAGE 3: Project Detail -->
<div class="page" id="pageDet">
  <div class="det-hdr">
    <button class="back-btn" onclick="goHome()">‚Üê</button>
    <div class="det-title">
      <div class="det-name" id="detName"></div>
      <div class="det-type" id="detType"></div>
    </div>
    <button class="det-del" onclick="delProj()">üóë</button>
  </div>
  <div class="det-bar">
    <div class="det-filters">
      <button class="dfil on-all" data-f="all" onclick="setFil('all')">ÂÖ®ÈÉ®</button>
      <button class="dfil" data-f="pending" onclick="setFil('pending')">Êú™ÂÆåÊàê</button>
      <button class="dfil" data-f="done" onclick="setFil('done')">Â∑≤ÂÆåÊàê</button>
    </div>
    <div class="det-spacer"></div>
    <div class="det-prog" id="detProg">0/0</div>
  </div>
  <div class="det-track"><div class="det-fill" id="detFill" style="width:0%"></div></div>
  <div class="det-list" id="detList"></div>
  <div class="det-bottom">
    <button class="btn" onclick="doShare()">üìã Ë§áË£Ω / ÂÇ≥ LINE Áµ¶ÂÆ¢Êà∂</button>
  </div>
</div>

<!-- Share Modal -->
<div class="modal-bg" id="modal">
  <div class="modal">
    <h3>üìã ÂÇ≥ÈÄÅÊñá‰ª∂Ê∏ÖÂñÆ</h3>
    <textarea id="modalText" readonly></textarea>
    <div class="modal-btns">
      <button class="mbtn mbtn-close" onclick="closeModal()">ÈóúÈñâ</button>
      <button class="mbtn mbtn-copy" onclick="copyText()">üìã Ë§áË£Ω</button>
      <button class="mbtn mbtn-line" onclick="shareLine()">üí¨ LINE</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
/* ===== DOCUMENT TEMPLATES ===== */
const T={
"Ëá™Âª∫-ÂÄã‰∫∫":{icon:"üè†",items:[
{n:1,t:"Áî≥Ë´ã‰∫∫Ë∫´ÂàÜË≠âÂΩ±Êú¨"},
{n:2,t:"Áî≥Ë´ã‰∫∫ÂåØÊ¨æÂÖ•Êà∂Â≠òÊë∫ÂΩ±Êú¨"},
{n:3,t:"Áî≥Ë´ã‰∫∫Âç∞Á´†ÊàñÂßî‰ªª‰ª£ÂàªÂêåÊÑèÊõ∏"},
{n:4,t:"ÈõªË°®ÁßüÁ¥Ñ‰øùË≠â‰∫∫Ë∫´ÂàÜË≠âÂΩ±Êú¨"},
{n:5,t:"ÈõªË°®ÁßüÁ¥Ñ‰øùË≠â‰∫∫Âç∞Á´†ÊàñÂßî‰ªª‰ª£ÂàªÂêåÊÑèÊõ∏"},
{n:6,t:"ÂúüÂú∞/Âª∫Áâ©ÊâÄÊúâÊ¨äÁãÄÂΩ±Êú¨",g:["ÂúüÂú∞","Âª∫Áâ©"],note:"Á¢∫Ë™çÊåÅÊúâ‰∫∫Êï∏"},
{n:7,t:"ÂúüÂú∞/Âª∫Áâ©ÊâÄÊúâÊ¨ä‰∫∫Ë∫´ÂàÜË≠âÂΩ±Êú¨",g:["ÂúüÂú∞","Âª∫Áâ©"],note:"ÊåÅÊúâ‰∫∫ÊúâÂπæ‰∫∫Â∞±Êèê‰æõÂπæ‰ªΩ"},
{n:8,t:"ÂúüÂú∞/Âª∫Áâ©ÊâÄÊúâÊ¨ä‰∫∫Âßî‰ªª‰ª£ÂàªÂêåÊÑèÊõ∏",g:["ÂúüÂú∞","Âª∫Áâ©"],note:"ÊåÅÊúâ‰∫∫ÊúâÂπæ‰ΩçÂ∞±Êèê‰æõÂπæ‰ªΩ"},
{n:9,t:"Âè∞Èõª-ÂúüÂú∞Êö®Âª∫Áâ©‰ΩøÁî®ÂêåÊÑèÊõ∏ √ó4‰ªΩ",note:"Ëã•ÂúüÂú∞/Âª∫Áâ©ÊåÅÊúâ‰∫∫ËàáÁî≥Ë´ã‰∫∫‰∏ÄËá¥ÂâáÁÑ°È†àÊèê‰æõ"},
{n:10,t:"ËÉΩÊ∫êÂ±Ä-ÂúüÂú∞Êö®Âª∫Áâ©‰ΩøÁî®ÂêåÊÑèÊõ∏ √ó3‰ªΩ",note:"Ëã•ÂúüÂú∞/Âª∫Áâ©ÊåÅÊúâ‰∫∫ËàáÁî≥Ë´ã‰∫∫‰∏ÄËá¥ÂâáÁÑ°È†àÊèê‰æõ"},
{n:11,t:"ÂêåÊÑèÂÇôÊ°àÁî≥Ë´ãË°®",note:"ÈúÄÂÆ¢Êà∂Ë¶™Á∞Ω"},
{n:12,t:"Âª∫Áâ©‰ΩøÁî®Âü∑ÁÖßÂΩ±Êú¨"},
{n:13,t:"ÊúÄËøë‰∏ÄÊúüÈõªË≤ªÂñÆ",note:"ÈúÄÈõªËôüÂèäÁî®ÈõªÂú∞ÂùÄÔºåËã•Êñ∞Âª∫Áâ©ÁÑ°ÈõªË≤ªÂñÆÈ†àÊèê‰æõÁî®ÈõªË≠âÊòé"}
]},
"Ëá™Âª∫-Ê≥ï‰∫∫":{icon:"üè¢",items:[
{n:1,t:"ÂÖ¨Âè∏Ë≤†Ë≤¨‰∫∫Ë∫´ÂàÜË≠âÂΩ±Êú¨"},
{n:2,t:"ÂÖ¨Âè∏ËÆäÊõ¥ÁôªË®òË°®ÔºàÂê´Â∏ÇÂ∫úÂáΩÊñáÔºâ"},
{n:3,t:"ÂÖ¨Âè∏Âç∞ÈëëÊéàÊ¨äÊõ∏ÔºàÂÖ´‰ªΩÔºâ"},
{n:4,t:"ÂÖ¨Âè∏ÂåØÊ¨æÂÖ•Êà∂Â≠òÊë∫ÂΩ±Êú¨"},
{n:5,t:"ÂÖ¨Âè∏Âç∞Á´†ÊàñÂßî‰ªª‰ª£ÂàªÂêåÊÑèÊõ∏"},
{n:6,t:"ÈõªË°®ÁßüÁ¥Ñ‰øùË≠â‰∫∫Ë∫´ÂàÜË≠âÂΩ±Êú¨"},
{n:7,t:"ÈõªË°®ÁßüÁ¥Ñ‰øùË≠â‰∫∫Âç∞Á´†ÊàñÂßî‰ªª‰ª£ÂàªÂêåÊÑèÊõ∏"},
{n:8,t:"ÂúüÂú∞/Âª∫Áâ©ÊâÄÊúâÊ¨äÁãÄÂΩ±Êú¨",g:["ÂúüÂú∞","Âª∫Áâ©"],note:"Á¢∫Ë™çÊåÅÊúâ‰∫∫Êï∏"},
{n:9,t:"ÂúüÂú∞/Âª∫Áâ©ÊâÄÊúâÊ¨ä‰∫∫Ë∫´ÂàÜË≠âÂΩ±Êú¨",g:["ÂúüÂú∞","Âª∫Áâ©"],note:"ÊåÅÊúâ‰∫∫ÊúâÂπæ‰∫∫Â∞±Êèê‰æõÂπæ‰ªΩ"},
{n:10,t:"ÂúüÂú∞/Âª∫Áâ©ÊâÄÊúâÊ¨ä‰∫∫‰ª£ÂàªÂç∞Á´†ÂêåÊÑèÊõ∏",g:["ÂúüÂú∞","Âª∫Áâ©"],note:"ÊåÅÊúâ‰∫∫ÊúâÂπæ‰ΩçÂ∞±Êèê‰æõÂπæ‰ªΩ"},
{n:11,t:"Âè∞Èõª-ÂúüÂú∞Êö®Âª∫Áâ©‰ΩøÁî®ÂêåÊÑèÊõ∏ √ó4‰ªΩ",note:"Ëã•ÂúüÂú∞/Âª∫Áâ©ÊåÅÊúâ‰∫∫ËàáÁî≥Ë´ã‰∫∫‰∏ÄËá¥ÂâáÁÑ°È†àÊèê‰æõ"},
{n:12,t:"ËÉΩÊ∫êÂ±Ä-ÂúüÂú∞Êö®Âª∫Áâ©‰ΩøÁî®ÂêåÊÑèÊõ∏ √ó3‰ªΩ",note:"Ëã•ÂúüÂú∞/Âª∫Áâ©ÊåÅÊúâ‰∫∫ËàáÁî≥Ë´ã‰∫∫‰∏ÄËá¥ÂâáÁÑ°È†àÊèê‰æõ"},
{n:13,t:"Âª∫Áâ©‰ΩøÁî®Âü∑ÁÖßÂΩ±Êú¨"},
{n:14,t:"ÊúÄËøë‰∏ÄÊúüÈõªË≤ªÂñÆ",note:"ÈúÄÈõªËôüÂèäÁî®ÈõªÂú∞ÂùÄÔºåËã•Êñ∞Âª∫Áâ©ÁÑ°ÈõªË≤ªÂñÆÈ†àÊèê‰æõÁî®ÈõªË≠âÊòé"},
{n:15,t:"ÂêåÊÑèÂÇôÊ°àÁî≥Ë´ãË°®",note:"Ëã•ÊúâÊèê‰æõÂç∞Á´†ÊàñÂßî‰ªª‰ª£ÂàªÂêåÊÑèÊõ∏ÂâáÁÑ°ÈúÄÊèê‰æõ"}
]},
"Âá∫Áßü-ÂÄã‰∫∫":{icon:"üîë",items:[
{n:1,t:"ÂúüÂú∞/Âª∫Áâ©ÊâÄÊúâÊ¨ä‰∫∫Ë∫´ÂàÜË≠âÂΩ±Êú¨",g:["ÂúüÂú∞","Âª∫Áâ©"],note:"ÊåÅÊúâ‰∫∫ÊúâÂπæ‰∫∫Â∞±Êèê‰æõÂπæ‰ªΩ"},
{n:2,t:"ÂúüÂú∞/Âª∫Áâ©ÊâÄÊúâÊ¨ä‰∫∫Âßî‰ªª‰ª£ÂàªÂêåÊÑèÊõ∏",g:["ÂúüÂú∞","Âª∫Áâ©"],note:"ÊåÅÊúâ‰∫∫ÊúâÂπæ‰∫∫Â∞±Êèê‰æõÂπæ‰ªΩ"},
{n:3,t:"ÂúüÂú∞/Âª∫Áâ©ÊâÄÊúâÊ¨äÁãÄÂΩ±Êú¨",g:["ÂúüÂú∞","Âª∫Áâ©"],note:"Á¢∫Ë™çÊåÅÊúâ‰∫∫Êï∏"},
{n:4,t:"Áî≥Ë´ã‰∫∫ÂåØÊ¨æÂÖ•Êà∂Â≠òÊë∫ÂΩ±Êú¨"},
{n:5,t:"Âª∫Áâ©‰ΩøÁî®Âü∑ÁÖßÂΩ±Êú¨"},
{n:6,t:"Âè∞Èõª-ÂúüÂú∞Êö®Âª∫Áâ©‰ΩøÁî®ÂêåÊÑèÊõ∏ √ó4‰ªΩ",note:"Ëã•ÂúüÂú∞/Âª∫Áâ©ÊåÅÊúâ‰∫∫ËàáÁî≥Ë´ã‰∫∫‰∏ÄËá¥ÂâáÁÑ°È†àÊèê‰æõ"},
{n:7,t:"ËÉΩÊ∫êÂ±Ä-ÂúüÂú∞Êö®Âª∫Áâ©‰ΩøÁî®ÂêåÊÑèÊõ∏ √ó3‰ªΩ",note:"Ëã•ÂúüÂú∞/Âª∫Áâ©ÊåÅÊúâ‰∫∫ËàáÁî≥Ë´ã‰∫∫‰∏ÄËá¥ÂâáÁÑ°È†àÊèê‰æõ"},
{n:8,t:"ÊúÄËøë‰∏ÄÊúüÈõªË≤ªÂñÆ",note:"ÈúÄÈõªËôüÂèäÁî®ÈõªÂú∞ÂùÄÔºåËã•Êñ∞Âª∫Áâ©ÁÑ°ÈõªË≤ªÂñÆÈ†àÊèê‰æõÁî®ÈõªË≠âÊòé"}
]},
"Âá∫Áßü-Ê≥ï‰∫∫":{icon:"üè¨",items:[
{n:1,t:"ÂúüÂú∞/Âª∫Áâ©ÊâÄÊúâÊ¨ä‰∫∫Ë∫´ÂàÜË≠âÂΩ±Êú¨",g:["ÂúüÂú∞","Âª∫Áâ©"],note:"ÊåÅÊúâ‰∫∫ÊúâÂπæ‰∫∫Â∞±Êèê‰æõÂπæ‰ªΩ"},
{n:2,t:"ÂúüÂú∞/Âª∫Áâ©ÊâÄÊúâÊ¨ä‰∫∫Âßî‰ªª‰ª£ÂàªÂêåÊÑèÊõ∏",g:["ÂúüÂú∞","Âª∫Áâ©"],note:"ÊåÅÊúâ‰∫∫ÊúâÂπæ‰∫∫Â∞±Êèê‰æõÂπæ‰ªΩ"},
{n:3,t:"ÂúüÂú∞/Âª∫Áâ©ÊâÄÊúâÊ¨äÁãÄÂΩ±Êú¨",g:["ÂúüÂú∞","Âª∫Áâ©"],note:"Á¢∫Ë™çÊåÅÊúâ‰∫∫Êï∏"},
{n:4,t:"ÂÖ¨Âè∏ËÆäÊõ¥ÁôªË®òË°®"},
{n:5,t:"Áî≥Ë´ã‰∫∫ÂåØÊ¨æÂÖ•Êà∂Â≠òÊë∫ÂΩ±Êú¨"},
{n:6,t:"Âª∫Áâ©‰ΩøÁî®Âü∑ÁÖßÂΩ±Êú¨"},
{n:7,t:"Âè∞Èõª-ÂúüÂú∞Êö®Âª∫Áâ©‰ΩøÁî®ÂêåÊÑèÊõ∏ √ó4‰ªΩ",note:"Ëã•ÂúüÂú∞/Âª∫Áâ©ÊåÅÊúâ‰∫∫ËàáÁî≥Ë´ã‰∫∫‰∏ÄËá¥ÂâáÁÑ°È†àÊèê‰æõ"},
{n:8,t:"ËÉΩÊ∫êÂ±Ä-ÂúüÂú∞Êö®Âª∫Áâ©‰ΩøÁî®ÂêåÊÑèÊõ∏ √ó3‰ªΩ",note:"Ëã•ÂúüÂú∞/Âª∫Áâ©ÊåÅÊúâ‰∫∫ËàáÁî≥Ë´ã‰∫∫‰∏ÄËá¥ÂâáÁÑ°È†àÊèê‰æõ"},
{n:9,t:"ÊúÄËøë‰∏ÄÊúüÈõªË≤ªÂñÆ",note:"ÈúÄÈõªËôüÂèäÁî®ÈõªÂú∞ÂùÄÔºåËã•Êñ∞Âª∫Áâ©ÁÑ°ÈõªË≤ªÂñÆÈ†àÊèê‰æõÁî®ÈõªË≠âÊòé"}
]},
"ÊäïË≥á-ÂÄã‰∫∫":{icon:"üí∞",items:[
{n:1,t:"Áî≥Ë´ã‰∫∫Ë∫´ÂàÜË≠âÂΩ±Êú¨"},
{n:2,t:"Áî≥Ë´ã‰∫∫Âç∞Á´†ÊàñÂßî‰ªª‰ª£ÂàªÂêåÊÑèÊõ∏"},
{n:3,t:"Áî≥Ë´ã‰∫∫Â≠òÊë∫ÂΩ±Êú¨"},
{n:4,t:"ÈõªË°®ÁßüÁ¥Ñ‰øùË≠â‰∫∫Ë∫´ÂàÜË≠âÂΩ±Êú¨"},
{n:5,t:"ÈõªË°®ÁßüÁ¥Ñ‰øùË≠â‰∫∫Âç∞Á´†ÊàñÂßî‰ªª‰ª£ÂàªÂêåÊÑèÊõ∏"},
{n:6,t:"ÂêåÊÑèÂÇôÊ°àÁî≥Ë´ãË°®",note:"ÈúÄÂÆ¢Êà∂Ë¶™Á∞Ω"}
]},
"ÊäïË≥á-Ê≥ï‰∫∫":{icon:"üè¶",items:[
{n:1,t:"ÂÖ¨Âè∏Ë≤†Ë≤¨‰∫∫Ë∫´ÂàÜË≠âÂΩ±Êú¨"},
{n:2,t:"ÂÖ¨Âè∏ËÆäÊõ¥ÁôªË®òË°®"},
{n:3,t:"ÂÖ¨Âè∏Âç∞ÈëëÊéàÊ¨äÊõ∏ÔºàÂÖ´‰ªΩÔºâ"},
{n:4,t:"ÂÖ¨Âè∏ÂåØÊ¨æÂÖ•Êà∂Â≠òÊë∫ÂΩ±Êú¨"},
{n:5,t:"ÂÖ¨Âè∏Âç∞Á´†ÊàñÂßî‰ªª‰ª£ÂàªÂêåÊÑèÊõ∏"},
{n:6,t:"ÈõªË°®ÁßüÁ¥Ñ‰øùË≠â‰∫∫Ë∫´ÂàÜË≠âÂΩ±Êú¨"},
{n:7,t:"ÈõªË°®ÁßüÁ¥Ñ‰øùË≠â‰∫∫Âç∞Á´†ÊàñÂßî‰ªª‰ª£ÂàªÂêåÊÑèÊõ∏"},
{n:8,t:"ÂêåÊÑèÂÇôÊ°àÁî≥Ë´ãË°®",note:"Ëã•ÊúâÊèê‰æõÂç∞Á´†ÊàñÂßî‰ªª‰ª£ÂàªÂêåÊÑèÊõ∏ÂâáÁÑ°ÈúÄÊèê‰æõ"}
]},
"ÁïúÁâßÂ†¥":{icon:"üêÑ",items:[
{n:1,t:"ÁïúÁâßÂ†¥Ë≤†Ë≤¨‰∫∫Ë∫´ÂàÜË≠âÂΩ±Êú¨"},
{n:2,t:"ÁïúÁâßÂ†¥Ë≤†Ë≤¨‰∫∫Âßî‰ªª‰ª£ÂàªÂêåÊÑèÊõ∏"},
{n:3,t:"ÁïúÁâßÂ†¥ÁôªË®òË≠âÊõ∏ÂΩ±Êú¨"},
{n:4,t:"ÂúüÂú∞Ë¨ÑÊú¨/ÊâÄÊúâÊ¨äÁãÄÂΩ±Êú¨",g:["ÂúüÂú∞"]},
{n:5,t:"Âª∫Áâ©Ë¨ÑÊú¨/ÊâÄÊúâÊ¨äÁãÄÂΩ±Êú¨",g:["Âª∫Áâ©"]},
{n:6,t:"Âª∫Áâ©‰ΩøÁî®Âü∑ÁÖßÂΩ±Êú¨"},
{n:7,t:"Âè∞Èõª-ÂúüÂú∞Êö®Âª∫Áâ©‰ΩøÁî®ÂêåÊÑèÊõ∏ÔºàÂõõ‰ªΩÔºâ"},
{n:8,t:"ËÉΩÊ∫êÂ±Ä-ÂúüÂú∞Êö®Âª∫Áâ©‰ΩøÁî®ÂêåÊÑèÊõ∏Ôºà‰∏â‰ªΩÔºâ"},
{n:9,t:"Ê†∏Á´†Á´£Â∑•Âúñ"},
{n:10,t:"Ëæ≤ÁâßÁî®Âú∞ÂÆπË®±‰ΩøÁî®ÂáΩÊñá"},
{n:11,t:"Á∂ìÁáüÁîüÁî¢Ë®àÁï´Êõ∏"},
{n:12,t:"ÁâπÁ¥ÑÁç∏ÈÜ´Â∏´ÂêàÁ¥ÑÊõ∏"},
{n:13,t:"ÂåñË£ΩÂª†ÂêàÁ¥ÑÊõ∏"},
{n:14,t:"Âª¢Ê£ÑÁâ©ËôïÁêÜÂêàÁ¥Ñ"},
{n:15,t:"Á∂ìÁáüÂØ¶Á∏æ"}
]},
"ÁâπÁôª":{icon:"üìã",items:[
{n:1,t:"Áî≥Ë´ã‰∫∫Ë∫´ÂàÜË≠â‰ª∂ÂΩ±Âç∞Êú¨/ÂÖ¨Âè∏Ë≤†Ë≤¨‰∫∫Ë∫´ÂàÜË≠âÂΩ±Êú¨"},
{n:2,t:"ÂÖ¨Âè∏ËÆäÊõ¥ÁôªË®òË°®"},
{n:3,t:"Âç∞ÈëëË≠âÊòéÔºà8‰ªΩÔºâ"},
{n:4,t:"Áî≥Ë´ã‰∫∫ÔºàÂÖ¨Âè∏ÔºâÂåØÊ¨æÂÖ•Êà∂Â≠òÊë∫ÂΩ±Êú¨"},
{n:5,t:"Áî≥Ë´ã‰∫∫ÔºàÂÖ¨Âè∏ÔºâÂç∞Á´†ÊàñÂßî‰ªª‰ª£ÂàªÂêåÊÑèÊõ∏"},
{n:6,t:"ÈõªË°®ÁßüÁ¥Ñ‰øùË≠â‰∫∫Âç∞Á´†ÊàñÂßî‰ªª‰ª£ÂàªÂêåÊÑèÊõ∏"},
{n:7,t:"ÈõªË°®ÁßüÁ¥Ñ‰øùË≠â‰∫∫Ë∫´ÂàÜË≠âÂΩ±Êú¨"},
{n:8,t:"ÂúüÂú∞ÊâÄÊúâÊ¨äÁãÄÂΩ±Êú¨"},
{n:9,t:"ÁâπÁôªÂáΩÊñá"},
{n:10,t:"ÂêÑÂ±§Ê®ìÂ±§Á´£Â∑•Âúñ"},
{n:11,t:"ÊúÄÊñ∞ÊàøÂ±ãÁ®ÖÁ±çË≠âÊòéÊõ∏"},
{n:12,t:"Âª∫Áâ©ÁµêÊßãÂÆâÂÖ®Ë≠âÊòéÊõ∏",note:"ÊäÄÂ∏´Áî®Âç∞Á∞ΩÂêç/Ë≠âÊõ∏"},
{n:13,t:"ÂúüÂú∞/Âª∫Áâ©ÊâÄÊúâÊ¨ä‰∫∫Ë∫´ÂàÜË≠âÂΩ±Êú¨",g:["ÂúüÂú∞","Âª∫Áâ©"]},
{n:14,t:"ÂúüÂú∞/Âª∫Áâ©ÊâÄÊúâÊ¨ä‰∫∫Âßî‰ªª‰ª£ÂàªÂêåÊÑèÊõ∏",g:["ÂúüÂú∞","Âª∫Áâ©"]},
{n:15,t:"Âè∞Èõª-ÂúüÂú∞Êö®Âª∫Áâ©‰ΩøÁî®ÂêåÊÑèÊõ∏ÔºàÂõõ‰ªΩÔºâ"},
{n:16,t:"ËÉΩÊ∫êÂ±Ä-ÂúüÂú∞Êö®Âª∫Áâ©‰ΩøÁî®ÂêåÊÑèÊõ∏Ôºà‰∏â‰ªΩÔºâ"},
{n:17,t:"ÊúÄËøë‰∏ÄÊúüÈõªË≤ªÂñÆ",note:"ÈúÄÈõªËôüÂèäÁî®ÈõªÂú∞ÂùÄÔºåËã•Êñ∞Âª∫Áâ©ÁÑ°ÈõªË≤ªÂñÆÈ†àÊèê‰æõÁî®ÈõªË≠âÊòé"}
]}
};

/* ===== STATE ===== */
let projects=[];
let curId=null;
let fil='all';
let selType='';

function load(){try{const s=localStorage.getItem('solar_v4');if(s)projects=JSON.parse(s)}catch(e){}}
function save(){try{localStorage.setItem('solar_v4',JSON.stringify(projects))}catch(e){}}
function getProj(){return projects.find(p=>p.id===curId)}

/* ===== NAVIGATION ===== */
function showPage(id){document.querySelectorAll('.page').forEach(p=>p.classList.remove('show'));document.getElementById(id).classList.add('show')}

function goHome(){showPage('pageList');renderList();curId=null}

/* ===== PROJECT LIST ===== */
function renderList(){
  const el=document.getElementById('projList');
  if(!projects.length){
    el.innerHTML=`<div class="empty-msg"><div class="em-icon">üìÇ</div><p>ÈÇÑÊ≤íÊúâÊ°à‰ª∂<br>ÈªûÂè≥‰∏ãËßí Ôºã Êñ∞Â¢ûÁ¨¨‰∏ÄÂÄãÊ°à‰ª∂</p></div>`;
    return;
  }
  // Sort: incomplete first, then by date desc
  const sorted=[...projects].sort((a,b)=>{
    const pa=getPct(a),pb=getPct(b);
    if(pa<100&&pb>=100)return -1;
    if(pa>=100&&pb<100)return 1;
    return b.created-a.created;
  });
  let html=`<h2>ÊâÄÊúâÊ°à‰ª∂ <span class="cnt">${projects.length}</span></h2>`;
  sorted.forEach(p=>{
    const tmpl=T[p.type];
    const total=tmpl.items.length;
    const done=tmpl.items.filter(i=>p.checked[i.n]).length;
    const pct=total?Math.round(done/total*100):0;
    const cls=pct>=100?'pct-done':pct>=50?'pct-mid':'pct-low';
    const color=pct>=100?'var(--green)':pct>=50?'var(--accent)':'var(--red)';
    const date=new Date(p.created);
    const ds=(date.getMonth()+1)+'/'+date.getDate();
    html+=`<div class="proj-card" onclick="openProj('${p.id}')">
      <div class="proj-top">
        <div class="proj-icon">${tmpl.icon}</div>
        <div class="proj-info">
          <div class="proj-name">${esc(p.name)}</div>
          <div class="proj-type">${p.type}</div>
        </div>
        <div class="proj-date">${ds}</div>
      </div>
      <div class="proj-prog">
        <div class="proj-track"><div class="proj-fill" style="width:${pct}%;background:${color}"></div></div>
        <div class="proj-pct ${cls}">${done}/${total}</div>
      </div>
    </div>`;
  });
  el.innerHTML=html;
}

function getPct(p){const t=T[p.type].items.length;const d=T[p.type].items.filter(i=>p.checked[i.n]).length;return t?Math.round(d/t*100):0}

/* ===== NEW PROJECT ===== */
function showNew(){
  selType='';
  document.getElementById('fName').value='';
  renderTypeGrid();
  showPage('pageNew');
  setTimeout(()=>document.getElementById('fName').focus(),200);
}

function renderTypeGrid(){
  const el=document.getElementById('typeGrid');
  el.innerHTML=Object.keys(T).map(k=>`<div class="type-opt ${k===selType?'sel':''}" onclick="pickType('${k}')">
    <div class="to-icon">${T[k].icon}</div>
    <div class="to-label">${k}</div>
  </div>`).join('');
}

function pickType(t){selType=t;renderTypeGrid()}

function createProj(){
  const name=document.getElementById('fName').value.trim();
  if(!name){toast('‚ö†Ô∏è Ë´ãËº∏ÂÖ•ÂÆ¢Êà∂ÂêçÁ®±');return}
  if(!selType){toast('‚ö†Ô∏è Ë´ãÈÅ∏ÊìáÂ∞àÊ°àÈ°ûÂûã');return}
  const p={id:'p'+Date.now(),name,type:selType,created:Date.now(),checked:{}};
  projects.unshift(p);
  save();
  toast('‚úÖ Ê°à‰ª∂Â∑≤Âª∫Á´ã');
  curId=p.id;
  showDetail();
}

/* ===== PROJECT DETAIL ===== */
function openProj(id){curId=id;fil='all';showDetail()}

function showDetail(){
  const p=getProj();if(!p)return goHome();
  showPage('pageDet');
  document.getElementById('detName').textContent=p.name;
  document.getElementById('detType').textContent=T[p.type].icon+' '+p.type;
  updFilBtn();
  renderItems();
  updDetProg();
}

function updFilBtn(){
  document.querySelectorAll('.dfil').forEach(b=>{b.className='dfil'+(b.dataset.f===fil?' on-'+b.dataset.f:'')});
}
function setFil(f){fil=f;updFilBtn();applyFil()}
function applyFil(){
  document.querySelectorAll('.item').forEach(el=>{
    const d=el.classList.contains('done');
    if(fil==='all')el.classList.remove('hide');
    else if(fil==='pending')el.classList.toggle('hide',d);
    else el.classList.toggle('hide',!d);
  });
}

function renderItems(){
  const p=getProj();if(!p)return;
  const items=T[p.type].items;
  document.getElementById('detList').innerHTML=items.map(i=>`<div class="item ${p.checked[i.n]?'done':''}" data-n="${i.n}" onclick="togItem(${i.n})">
    <div class="ck"><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg></div>
    <div class="icontent">
      <div class="inum">#${i.n}</div>
      <div class="itxt">${i.t}</div>
      ${(i.g||[]).map(t=>`<span class="itag ${t==='ÂúüÂú∞'?'t-land':'t-bld'}">${t}</span>`).join('')}
      ${i.note?`<div class="inote">üí° ${i.note}</div>`:''}
    </div>
  </div>`).join('');
  applyFil();
}

function togItem(n){
  const p=getProj();if(!p)return;
  p.checked[n]=!p.checked[n];
  const el=document.querySelector(`.item[data-n="${n}"]`);
  if(el)el.classList.toggle('done');
  save();updDetProg();applyFil();
}

function updDetProg(){
  const p=getProj();if(!p)return;
  const items=T[p.type].items;
  const total=items.length,done=items.filter(i=>p.checked[i.n]).length;
  const pct=total?Math.round(done/total*100):0;
  document.getElementById('detFill').style.width=pct+'%';
  document.getElementById('detProg').textContent=done+'/'+total;
}

function delProj(){
  const p=getProj();if(!p)return;
  if(confirm('Á¢∫ÂÆöË¶ÅÂà™Èô§„Äå'+p.name+'„ÄçÔºüÊ≠§Êìç‰ΩúÁÑ°Ê≥ïÂæ©Âéü„ÄÇ')){
    projects=projects.filter(x=>x.id!==p.id);
    save();toast('Â∑≤Âà™Èô§');goHome();
  }
}

/* ===== SHARE ===== */
function buildMsg(){
  const p=getProj();if(!p)return'';
  const items=T[p.type].items;
  const pending=items.filter(i=>!p.checked[i.n]);
  const done=items.filter(i=>p.checked[i.n]);
  let m=p.name+' ÊÇ®Â•ΩÔºÅ\n\n‰ª•‰∏ãÊòØ„Äå'+p.type+'„ÄçÊ°à‰ª∂ÈúÄË¶ÅÊ∫ñÂÇôÁöÑÊñá‰ª∂Ôºö\n\n';
  if(pending.length){
    m+='üìå Â∞öÈúÄÊèê‰æõÔºà'+pending.length+'È†ÖÔºâÔºö\n';
    pending.forEach(i=>{m+='‚òê '+i.n+'. '+i.t+'\n';if(i.note)m+='   ‚ö†Ô∏è '+i.note+'\n'});
  }
  if(done.length){
    m+='\n‚úÖ Â∑≤Êî∂Âà∞Ôºà'+done.length+'È†ÖÔºâÔºö\n';
    done.forEach(i=>m+='‚úì '+i.n+'. '+i.t+'\n');
  }
  m+='\nË´ãÁõ°Âø´Êèê‰æõ‰ª•‰∏äÊñá‰ª∂Ôºå‰ª•Âà©ÂæåÁ∫åÈñãÊ°à‰ΩúÊ•≠ÔºåË¨ùË¨ù üôè';
  return m;
}

function doShare(){
  const m=buildMsg();
  document.getElementById('modalText').value=m;
  document.getElementById('modal').classList.add('show');
  try{if(navigator.clipboard)navigator.clipboard.writeText(m).then(()=>toast('‚úÖ Â∑≤Ëá™ÂãïË§áË£Ω'))}catch(e){}
}

function copyText(){
  const ta=document.getElementById('modalText');
  ta.focus();ta.select();ta.setSelectionRange(0,999999);
  try{document.execCommand('copy');toast('‚úÖ Â∑≤Ë§áË£ΩÔºÅ')}catch(e){toast('Ë´ãÈï∑ÊåâÊñáÂ≠óÊâãÂãïË§áË£Ω')}
}

function shareLine(){
  const m=buildMsg();
  window.open('https://line.me/R/share?text='+encodeURIComponent(m),'_blank');
  closeModal();
}

function closeModal(){document.getElementById('modal').classList.remove('show')}
document.getElementById('modal').addEventListener('click',function(e){if(e.target===this)closeModal()});

function esc(s){const d=document.createElement('div');d.textContent=s;return d.innerHTML}
function toast(m){const t=document.getElementById('toast');t.textContent=m;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2200)}

/* ===== INIT ===== */
load();renderList();
</script>
</body>
</html>
